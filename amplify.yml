version: 1
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            # Instala dependencias
            - npm ci
        build:
          commands:
            # Compila el proyecto con Astro
            - npm run build
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
    backend:
      phases:
        build:
          commands:
            # No se necesita build backend extra, solo empaquetar el SSR
            - echo "Building Astro SSR app for Amplify"
      artifacts:
        baseDirectory: dist
        files:
          - '**/*'
    # Configuraci√≥n de runtime Node.js
    start:
      command: node ./dist/server/entry.mjs

    environment:
      # Variables de entorno necesarias para Supabase
      variables:
        NODE_ENV: production
        PUBLIC_SUPABASE_URL: https://TU_PROYECTO.supabase.co
        PUBLIC_SUPABASE_ANON_KEY: TU_ANON_KEY
